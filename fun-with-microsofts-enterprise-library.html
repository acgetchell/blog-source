<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Fun with Microsoft’s Enterprise Library - Adam's Entropy</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="http://adamgetchell.org/fun-with-microsofts-enterprise-library.html">

        <meta name="author" content="Adam Getchell" />
        <meta name="keywords" content=".net" />
        <meta name="description" content="Oh yeah, back to my day-job: I’m a programmer. So we’ve got a new application to update the current stone-tablet process in the University that determines if students actually graduate. Now, I like to write good code, and furthermore, if someone else writes it for me, that’s ..." />

        <meta property="og:site_name" content="Adam's Entropy" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Fun with Microsoft’s Enterprise Library"/>
        <meta property="og:url" content="http://adamgetchell.org/fun-with-microsofts-enterprise-library.html"/>
        <meta property="og:description" content="Oh yeah, back to my day-job: I’m a programmer. So we’ve got a new application to update the current stone-tablet process in the University that determines if students actually graduate. Now, I like to write good code, and furthermore, if someone else writes it for me, that’s ..."/>
        <meta property="article:published_time" content="2007-09-22" />
            <meta property="article:section" content="Programming" />
            <meta property="article:tag" content=".net" />
            <meta property="article:author" content="Adam Getchell" />

    <meta name="twitter:card" content="summary">
        <meta name="twitter:site" content="@adamgetchell">
        <meta name="twitter:creator" content="@adamgetchell">
    <meta name="twitter:domain" content="http://adamgetchell.org">

    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://adamgetchell.org/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="http://adamgetchell.org/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://adamgetchell.org/theme/css/pygments/native.css" rel="stylesheet">
        <link href="http://adamgetchell.org/theme/css/typogrify.css" rel="stylesheet">
    <link rel="stylesheet" href="http://adamgetchell.org/theme/css/style.css" type="text/css"/>

        <link href="http://adamgetchell.org/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Adam's Entropy ATOM Feed"/>



        <link href="http://adamgetchell.org/feeds/programming.atom.xml" type="application/atom+xml" rel="alternate"
              title="Adam's Entropy Programming ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://adamgetchell.org/" class="navbar-brand">
Adam's Entropy            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://adamgetchell.org/category/misc.html">Misc</a>
                        </li>
                        <li >
                            <a href="http://adamgetchell.org/category/physics.html">Physics</a>
                        </li>
                        <li class="active">
                            <a href="http://adamgetchell.org/category/programming.html">Programming</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://adamgetchell.org/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <ol class="breadcrumb">
                <li><a href="http://adamgetchell.org" title="Adam's Entropy"><i class="fa fa-home fa-lg"></i></a></li>
                <li><a href="http://adamgetchell.org/category/programming.html" title="Programming">Programming</a></li>
                <li class="active">Fun with Microsoft&#8217;s Enterprise&nbsp;Library</li>
            </ol>
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://adamgetchell.org/fun-with-microsofts-enterprise-library.html"
                       rel="bookmark"
                       title="Permalink to Fun with Microsoft’s Enterprise Library">
                        Fun with Microsoft&#8217;s Enterprise&nbsp;Library
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2007-09-22T23:42:00-07:00"> Sat 22 September 2007</time>
    </span>



        <span class="label label-default">Category</span>
        <a href="http://adamgetchell.org/category/programming.html">Programming</a>


<span class="label label-default">Tags</span>
	<a href="http://adamgetchell.org/tag/net.html">.net</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Oh yeah, back to my day-job: I&#8217;m a&nbsp;programmer.  </p>
<p>So we&#8217;ve got a new application to update the current stone-tablet
process in the University that determines if students actually&nbsp;graduate.  </p>
<p>Now, I like to write good code, and furthermore, if someone else writes
it for me, that&#8217;s even better. So if you are working on the .<span class="caps">NET</span>
platform, you&#8217;d do well to look at the <a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=0325B97A-9534-4349-8038-D56B38EC394C&amp;displaylang=en">Enterprise
Library</a>.  </p>
<p>Of course, this is several thousand lines of code to pore over, good
stuff, but unfortunately we have these minor annoying things called
deadlines which prevents us from taking the time to grok everything&nbsp;properly.  </p>
<p>Come to think of it, this happens in Physics, too &#8212; I never have enough
time to actually understand all the details of the problems I&#8217;m supposed
to be solving, but my advisor assures me that this is the proper state
of things in research, as opposed to writing text books, and three
guesses as to which one gets you&nbsp;tenure.  </p>
<p>Back to the matter at hand &#8212; the Enterprise Library. Looking around at
some good <a href="http://blog.hishambaz.com/archive/2005/01/29/194.aspx">working
examples</a> ,
hilarity and pandemonium ensues when you try to do something simple like
write to the Event Log when your application barfs. (Did I mention this
doesn&#8217;t come up a lot because instrumenting software seems to be a &#8230;
novelty?) I&#8217;m pretty sure that developers should <span
style="font-weight: bold;">not</span> be doing things like editing the
Registry, installing Services, or setting accounts programs run under
with full admin rights &#8212; I was a system administrator in a previous
job, and I <span style="font-weight: bold;">hated</span> letting
programmers do those kind of&nbsp;things.  </p>
<p>So I won&#8217;t inflict the same damage on our own, long-suffering&nbsp;sysadmin.  </p>
<p>Now, my 52-line class solution doesn&#8217;t do all the bells and whistles the
<span class="caps">EL</span> does, but it sure doesn&#8217;t require all the nastiness&nbsp;above:  </p>
<div class="cf">

<span class="cb1">using</span> System;

<span class="cb1">using</span> System.Diagnostics;

 

<span class="cb1">namespace</span> <span class="caps">CAESDO</span>

{

    <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\<summary\></span>

    <span class="cb2">///</span><span class="cb3"> Methods to handle
error reporting</span>

    <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\</summary\></span>

    <span class="cb1">public</span> <span class="cb1">class</span>
ErrorHandler

    {

        <span class="cb1">public</span> ErrorHandler()

        {

            <span class="cb3">// Register application as source for
Application log</span>

            <span class="cb1">if</span>
(!EventLog.SourceExists(&#8220;FacultyStudentSurveys&#8221;))

                EventLog.CreateEventSource(&#8220;FacultyStudentSurveys&#8221;,
&#8220;Application&#8221;);

        }

 

        <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\<summary\></span>

        <span class="cb2">///</span><span class="cb3"> Writes an error
message to the Application Event Log</span>

        <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\</summary\></span>

        <span class="cb2">///</span><span class="cb3"></span><span
class="cb2">\<param name="error"\></span><span class="cb3">The thrown
exception</span><span class="cb2">\</param\></span>

        <span class="cb1">internal</span> <span class="cb1">void</span>
WriteToEventLog(Exception error)

        {

            <span class="cb1">const</span> <span
class="cb1">string</span> source = &#8220;Commencement&#8221;;

            <span class="cb1">const</span> <span
class="cb1">string</span> logName = &#8220;Application&#8221;;

            EventLogEntryType enumType = EventLogEntryType.Error;

 

            EventLog objectLog = <span class="cb1">new</span>
EventLog(logName);

            objectLog.Source = source;

            objectLog.WriteEntry(error.Message, enumType, 1 );

        }

 

        <span class="cb1">internal</span> <span class="cb1">void</span>
WriteToEventLog(<span class="cb1">string</span> message, <span
class="cb1">bool</span> success)

        {

            <span class="cb1">const</span> <span
class="cb1">string</span> source = &#8220;Commencement&#8221;;

            <span class="cb1">const</span> <span
class="cb1">string</span> logName = &#8220;Application&#8221;;

            EventLogEntryType enumType;

 

            <span class="cb1">if</span> (success)

            {

                enumType = EventLogEntryType.Information;

            }

            <span class="cb1">else</span>

            {

                enumType = EventLogEntryType.Error;

            }

            EventLog objectLog = <span class="cb1">new</span>
EventLog(logName);

            objectLog.Source = source;

            objectLog.WriteEntry(message, enumType);

        }

    }

}

</div>

<p>I&#8217;m sure I&#8217;ve missed something obvious.&nbsp;Anyone?  </p>
<p>I just got a reply from the Hisam Baz, author of the above weblog which
says, &#8220;Why write 52 lines of code when you can write&nbsp;1?&#8221;.  </p>
<p>To which I reply, &#8220;I&#8217;d be happy to write 1 line of code &#8212; if it&nbsp;works.&#8221;  </p>
<p>Which brings us to the second&nbsp;problem:  </p>
<p><span style="font-weight: bold;">Non-portable references to the Global
Assembly Cache in <span class="caps">ASP</span>.<span class="caps">NET</span></span>  </p>
<p>Once you actually try to use the Enterprise Library, you&#8217;ll often come
across this bit of&nbsp;advice:  </p>
<p><span class="dquo">&#8220;</span><span style="font-weight: bold; font-style: italic;">References  </p>
<p></span><span style="font-style: italic;">Then from your application, add
references to
Microsoft.Practices.EnterpriseLibrary.Configuration.dll</span><br />
<span style="font-style: italic;">and
Microsoft.Practices.EnterpriseLibrary.Logging.dll from the C:\Program
Files\Microsoft Enterprise Library\bin\ directory. You should
consider signing the assemblies and then adding them to the <span class="caps">GAC</span>. You
should also add a copy of the assemblies to C:\Program Files\Microsoft
Visual Studio .<span class="caps">NET</span> 2003\Common7\<span class="caps">IDE</span>. Once you do that, you can select
the assemblies directly from the &#8220;Add Reference&#8221; dialog. One you&#8217;ve
added the reference, then add the appropriate using statement - using
Microsoft.Practices.EnterpriseLibrary.Logging - to your&nbsp;code.&#8221;</span>  </p>
<p>There&#8217;s only one problem &#8212; it doesn&#8217;t&nbsp;work.  </p>
<ol>
<li>
<p>When Visual Studio 2003 .<span class="caps">NET</span> looks for references in the Global
Assembly Cache, it never updates its view of the <span class="caps">GAC</span> in response to what
you&#8217;ve added &#8212; that&#8217;s done by the
<a href="http://support.microsoft.com/default.aspx?scid=kb;en-us;306149">registry</a>
(bleah). Which is why you&#8217;ve got to add a copy where <span class="caps">VS</span> can find&nbsp;it.  </p>
</li>
<li>
<p>When writing <span class="caps">ASP</span>.<span class="caps">NET</span> applications, references should be against
assemblies in the webserver <span class="caps">GAC</span>. And naturally, installer projects
written in <span class="caps">VS</span> 2003 do not install the files in the <span class="caps">GAC</span> automatically, as
they do for the web application itself. So now you have to manually add
assemblies to the <span class="caps">GAC</span> and write registry entries for each assembly to be
resolved by the .<span class="caps">NET</span>&nbsp;runtime.  </p>
</li>
</ol>
<p>Wait, why are we <a href="http://www.sellsbrothers.com/news/showTopic.aspx?ixTopic=1199">using the
<span class="caps">GAC</span></a>&nbsp;again?  </p>
<p>Okay, looks like I&#8217;ll have to wade through <a href="http://www.grimes.demon.co.uk/workshops/fusionWS.htm">Richard Grime&#8217;s Fusion
Workshop</a>. Except
that it doesn&#8217;t cover the case I&#8217;m interested in.&nbsp;Joy.  </p>
<p>Well, I sure hope that the 10 lines of code I&#8217;ll end up emitting in this
exercise will exceed the several thousand I could be writing if I just
wrote everything&nbsp;myself.  </p>
<p>What&#8217;s that again about the virtues of programmers? Laziness,
impatience, and hubris. Oh, alright&nbsp;then.</p>
</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'adamsentropy'; // required: replace example with your forum shortname

                    var disqus_identifier = 'fun-with-microsofts-enterprise-library';
                var disqus_url = 'http://adamgetchell.org/fun-with-microsofts-enterprise-library.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="images/adam_ben.jpg"/>
        </p>
    <p>
        <strong>About Adam Getchell</strong><br/>
        Physics and computing
    </p>
</div>
<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="http://about.me/adamgetchell"><i class="fa fa-aboutme-square fa-lg"></i> AboutMe</a></li>
                <li class="list-group-item"><a href="https://twitter.com/adamgetchell"><i class="fa fa-twitter-square fa-lg"></i> Twitter</a></li>
                <li class="list-group-item"><a href="http://www.linkedin.com/in/adamgetchell"><i class="fa fa-linkedin-square fa-lg"></i> LinkedIn</a></li>
                <li class="list-group-item"><a href="http://github.com/acgetchell"><i class="fa fa-github-square fa-lg"></i> GitHub</a></li>
                <li class="list-group-item"><a href="http://www.last.fm/user/adamgetchell"><i class="fa fa-lastfm-square fa-lg"></i> LastFM</a></li>
              </ul>
            </li>






    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
    </li>

    <li class="list-group-item"><h4><i class="fa fa-twitter fa-lg"></i><span class="icon-label">Latest Tweets</span></h4></li>
    <div id="twitter_timeline">
        <a class="twitter-timeline" data-chrome="noheader" href="https://twitter.com/adamgetchell" data-widget-id="701556215399194624">Tweets by adamgetchell</a>
    </div>

<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://mozillascience.org" target="_blank">
                Mozilla Science Lab
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://arxiv.org/find/all/1/all:+AND+triangulations+AND+causal+dynamical/0/1/0/all/0/1" target="_blank">
                Current CDT papers
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2014 Adam Getchell
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://adamgetchell.org/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://adamgetchell.org/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://adamgetchell.org/theme/js/respond.min.js"></script>

    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://adamgetchell.org/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'acgetchell',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://adamgetchell.org/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'adamsentropy'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>